Creating an ESX server (vmware) from a kickstart file (ks.cfg)

NOTE:  The server nic must be plugged in.  (See error below for suggestions on how to modify the ks.cfg to point to a plugged in nic)

1.	First create your ks.cfg file using the document titled:  How to create a ks.cfg file from an ESX Server for use in recovering the server during DR in Trim, and save the file to a floppy disk.

2.	Boot the ESX Server 3.0.1 installation disk and at the first prompt place the floppy in the floppy drive.  Type the following:  esx ks=floppy method=cdrom.

3.	Press enter

4.	Follow all default settings.


NOTE:  Possible error if the nic is not plugged in OR not pointing to the plugged in nic:

Traceback (most recent call last):
	File “/usr/bin/anaconda”, line 1044, in ?
	  instClass.setInstallData(id)
	File “user/lib/anaconda/kickstart.py”, line 1329, in setInstallData
  	  Self.readKickstart (id, self.file)
	File “user/lib/anaconda/kickstart.py”, line 772, in readKickstart
	  Handlers[args[0]](id, args[1:])
	File “user/lib/anaconda/kickstart.py”, line 462, in doNetwork
	  Self.setnetwork(id, bootProto, ip, netmask,ethtool, device=device)
	File “user/lib/anaconda/kickstart.py”, line 409, in setNetwork
	  Dev=devices[device]
KeyError: eth4
Install exited abnormally

And so on

The important part of this error message is the KeyError: eth4.  This error is referring to the slot the nic occupies.  In this error eth4 refers to the nic in the 4th slot.  In line 8 of the ks.cfg below you will see network –device eth4.  Modify network –device eth4 to network –device eth0 or to whichever nic slot you are using.  FYI – IP addresses and hostnames can be changed also.  Using notepad to make the changes in this file seemed to work just fine.





Sample ks.cfg

# Kickstart file automatically generated by anaconda. 
install 
lang en_US.UTF-8 
langsupport --default en_US.UTF-8 
keyboard us 
mouse generic3usb --device input/mice 
skipx 
network --device eth4 --bootproto static --ip 172.16.10.64 --netmask 255.255.0.0 --gateway 172.16.1.1 --nameserver 172.16.10.98,172.16.10.97 --hostname vhost2.ashp.org --addvmportgroup=0 --vlanid=0 
rootpw --iscrypted 
firewall --enabled 
authconfig --enableshadow --enablemd5 
timezone --utc America/New_York 
bootloader --location=mbr 
# The following is the partition information you requested 
# Note that any partitions you deleted are not expressed 
# here so unless you clear all partitions first, this is 
# not guaranteed to work #clearpart --all 
#part /boot --fstype ext3 --size=100 --ondisk=sda --asprimary 
#part / --fstype ext3 --size=3072 --ondisk=sda --asprimary 
#part swap --size=544 --ondisk=sda --asprimary 
#part /var/log --fstype ext3 --size=2048 --ondisk=sda 
#part /tmp --fstype ext3 --size=1024 --ondisk=sda 
#part /home --fstype ext3 --size=512 --ondisk=sda 
#part /vmimages --fstype ext3 --size=100 --grow --ondisk=sda 

%packages 
grub 

%post
